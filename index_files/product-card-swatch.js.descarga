if(!customElements.get("pcard-swatch")){class ProductCardColorSwatch extends HTMLElement{constructor(){super(),this.selectors={container:"[data-pcard-variant-picker]",optionNodes:[".m-product-option--node__label"],featuredImage:".m-product-card__main-image",pcard:".m-product-card",variantDropdown:".m-product-option--dropdown-select",priceWrapper:".m-price",salePrice:".m-price-item--sale",compareAtPrice:[".m-price-item--regular"],unitPrice:".m-price__unit",soldOutBadge:".m-product-tag--soldout"},this.container=this.closest(this.selectors.container),this.pcard=this.closest(this.selectors.pcard),this.variantIdNode=this.pcard&&this.pcard.querySelector('[name="id"]'),this.featuredImage=this.pcard&&this.pcard.querySelector(this.selectors.featuredImage),this.keepFeaturedImage=this.dataset.keepFeaturedImage==="true",this.domNodes=queryDomNodes(this.selectors,this.pcard),this.initializeData()}async initializeData(){this.variantData=this.fetchVariantData(),this.productHandle=this.container.dataset.productHandle,this.productData=await this.fetchProductJson(),this.activeOptionNodeByPosition={},this.hideUnavailableProductOptions=MinimogSettings.hide_unavailable_product_options;const{variantIdNode,productData,productData:{variants}={}}=this;if(productData){let currentVariantId=variantIdNode&&Number(variantIdNode.value);currentVariantId||(currentVariantId=productData.selected_or_first_available_variant&&productData.selected_or_first_available_variant.id);const currentVariant=variants.find(v=>v.id===currentVariantId)||variants[0];this.productData.initialVariant=currentVariant,!this.productData.selected_variant&&variantIdNode&&variantIdNode.dataset.selectedVariant&&(this.productData.selected_variant=variants.find(v=>v.id===Number(variantIdNode.dataset.selectedVariant))),this.keepFeaturedImage||(this.updateOptionsByVariant(currentVariant),this.updateProductImage(currentVariant),window.MinimogEvents.subscribe("m:image-loaded",()=>{this.updateProductImage(currentVariant)}))}this.initializeOptionSwatches(),this.domNodes.optionNodes&&this.domNodes.optionNodes.forEach(node=>node.addEventListener("click",this.handleVariantSelection.bind(this))),this.domNodes.variantDropdown&&this.domNodes.variantDropdown.addEventListener("change",this.handleVariantSelection.bind(this))}fetchVariantData(){if(!this.variantData){var jsonElement=this.container&&this.container.querySelector('[type="application/json"]');this.variantData=JSON.parse(jsonElement?jsonElement.textContent:"{}")}return this.variantData}fetchProductJson(){var productUrl=`${window.MinimogSettings.routes.root}/products/${this.productHandle}.js`;return productUrl=productUrl.replace("//","/"),fetch(productUrl).then(function(response){return response.json()})}initializeOptionSwatches(){const{_colorSwatches=[],_imageSwatches=[]}=window.MinimogSettings;this.domNodes.optionNodes.forEach(optNode=>{const{optionType,optionPosition,value:optionValue}=optNode.dataset,optionValueLowerCase=optionValue&&optionValue.toLowerCase(),variantToShowSwatchImage=this.variantData.find(v=>v[`option${optionPosition}`]===optionValue),variantImage=variantToShowSwatchImage&&variantToShowSwatchImage.featured_image&&variantToShowSwatchImage.featured_image.src?getSizedImageUrl(variantToShowSwatchImage.featured_image.src,"60x"):null,customImage=_imageSwatches.find(i=>i.key===optionValueLowerCase)&&_imageSwatches.find(i=>i.key===optionValueLowerCase).value,customColor=_colorSwatches.find(c=>c.key===optionValueLowerCase)&&_colorSwatches.find(c=>c.key===optionValueLowerCase).value;switch((variantImage||customImage)&&optNode.classList.add("has-bg-img"),optionType){case"default":case"image":(customImage||variantImage)&&(optNode.style.backgroundImage=`url(${customImage||variantImage||""})`);break;case"color":optNode.style.background=customColor||optionValueLowerCase,customImage&&(optNode.style.backgroundImage=`url(${customImage})`);break;default:break}})}toggleOptionNodeActive(optNode,active){if(optNode)if(active){const{optionPosition,value:optionValue}=optNode.dataset;switch(this.activeOptionNodeByPosition[optionPosition]=optNode,optNode.tagName){case"INPUT":optNode.checked=!0,optNode.dataset.selected="true";break;case"OPTION":optNode.dataset.selected="true";const select=optNode.closest("select");select&&(select.value=optNode.value);break;case"LABEL":optNode.dataset.selected="true";break;default:optNode.classList.contains("m-product-quickview-button")||console.warn("Unable to activate option node",optNode);break}this.updateSoldOutBadge(this.getVariantsByOptionValue(optionValue))}else{["default","image","color"].includes(optNode.dataset.optionType)||(optNode.style.border=""),optNode.checked=!1,delete optNode.dataset.selected;const select=optNode.closest("select");select&&(select.value="")}}updateOptionsByVariant(variant){Object.values(this.activeOptionNodeByPosition).forEach(optNode=>this.toggleOptionNodeActive(optNode,!1));const{optionNodes}=this.domNodes,{options=[]}=variant||{};options.forEach((option,index)=>{const optPosition=index+1;optionNodes.forEach(optNode=>{const _optPosition=Number(optNode.dataset.optionPosition),_optValue=optNode.dataset.value;_optPosition===optPosition&&option===_optValue&&this.toggleOptionNodeActive(optNode,!0)})}),this.updatePrice(variant)}getVariantFromActiveOptions=()=>{const{productData,productData:{initialVariant},activeOptionNodeByPosition}=this,initialVariantOptions={1:initialVariant.option1,2:initialVariant.option2,3:initialVariant.option3};Object.values(activeOptionNodeByPosition).forEach(optNode=>{const{optionPosition,value}=optNode.dataset;initialVariantOptions[optionPosition]=value});var options=Object.values(initialVariantOptions).filter(Boolean),variant=getVariantFromOptionArray(productData,options);return!variant&&this.hideUnavailableProductOptions&&(options.pop(),variant=getVariantFromOptionArray(productData,options),variant||(options.pop(),variant=getVariantFromOptionArray(productData,options))),this.currentVariant=variant,variant};handleVariantSelection(e){var target=e.target,newVariant;if(target.classList.contains("combined-variant")){const variantId=Number(e.target.value);newVariant=this.productData&&this.productData.variants&&this.productData.variants.find(v=>v.id===variantId)}else{target.tagName==="SELECT"&&(target=target.querySelectorAll("option")[target.selectedIndex]),target.classList.contains("m-product-option--node__label")||(target=target.closest(".m-product-option--node__label"),target||console.error("Unable to find option node!"));const{optionPosition}=target.dataset,currActiveOptNode=this.activeOptionNodeByPosition[optionPosition];this.toggleOptionNodeActive(currActiveOptNode,!1),this.toggleOptionNodeActive(target,!0),newVariant=this.getVariantFromActiveOptions()}const{variantIdNode}=this;variantIdNode&&(variantIdNode.setAttribute("value",String(newVariant.id)),variantIdNode.value=String(newVariant.id)),this.updateBySelectedVariant(newVariant)}updateBySelectedVariant(variant){variant&&(this.updateProductImage(variant),this.updatePrice(variant))}updateProductCardSoldOutBadge(variant){this.domNodes.soldOutBadge&&(this.domNodes.soldOutBadge.style.display=variant.available?"none":"flex")}updateSoldOutBadge(variants){const soldOut=!variants.some(variant=>variant.available);this.domNodes.soldOutBadge&&(this.domNodes.soldOutBadge.style.display=soldOut?"flex":"none")}getVariantsByOptionValue=value=>{const{productData:{variants}={}}=this;return variants.filter(variant=>variant.options.includes(value))};updateProductImage(variant){const src=variant&&variant.featured_image&&variant.featured_image.src,{featuredImage}=this,img=featuredImage&&featuredImage.querySelector("img");img&&src&&(img.src=`${src}&width=533`,img.removeAttribute("srcset"))}updatePrice(variant){if(MinimogSettings.pcard_show_lowest_prices)return;const classes={onSale:"m-price--on-sale",soldOut:"m-price--sold-out"},moneyFormat=window.MinimogSettings.money_format,{priceWrapper,salePrice,unitPrice,compareAtPrice}=this.domNodes,{compare_at_price,price,unit_price_measurement}=variant,onSale=compare_at_price&&compare_at_price>price,soldOut=!variant.available;if(onSale?priceWrapper&&priceWrapper.classList.add(classes.onSale):priceWrapper&&priceWrapper.classList.remove(classes.onSale),soldOut?priceWrapper&&priceWrapper.classList.add(classes.soldOut):priceWrapper&&priceWrapper.classList.remove(classes.soldOut),priceWrapper&&priceWrapper.classList.remove("visibility-hidden"),salePrice&&(salePrice.innerHTML=formatMoney(price,moneyFormat)),compareAtPrice&&compareAtPrice.length&&compare_at_price>price?compareAtPrice.forEach(item=>item.innerHTML=formatMoney(compare_at_price,moneyFormat)):compareAtPrice.forEach(item=>item.innerHTML=formatMoney(price,moneyFormat)),unit_price_measurement&&unitPrice&&this.currentVariant){unitPrice.classList.remove("f-hidden");const unitPriceContent=`<span>${formatMoney(this.currentVariant.unit_price,moneyFormat)}</span>/<span data-unit-price-base-unit>${this.getBaseUnit()}</span>`;unitPrice.innerHTML=unitPriceContent}else unitPrice&&unitPrice.classList.add("f-hidden")}getBaseUnit=()=>this.currentVariant.unit_price_measurement.reference_value===1?this.currentVariant.unit_price_measurement.reference_unit:this.currentVariant.unit_price_measurement.reference_value+this.currentVariant.unit_price_measurement.reference_unit}if(customElements.define("pcard-swatch",ProductCardColorSwatch),!customElements.get("swatch-button")){class ProductCardVariantButton extends HTMLElement{constructor(){super()}}if(customElements.define("swatch-button",ProductCardVariantButton),!customElements.get("swatch-dropdown")){class ProductCardVariantSelect extends ProductCardVariantButton{constructor(){super()}}customElements.define("swatch-dropdown",ProductCardVariantSelect)}if(!customElements.get("swatch-image")){class ProductCardVariantImage extends ProductCardVariantButton{constructor(){super()}}customElements.define("swatch-image",ProductCardVariantImage)}if(!customElements.get("swatch-color")){class ProductCardVariantColor extends ProductCardVariantButton{constructor(){super()}}customElements.define("swatch-color",ProductCardVariantColor)}}}
//# sourceMappingURL=/cdn/shop/t/7/assets/product-card-swatch.js.map?v=16537672688139098451727465277
