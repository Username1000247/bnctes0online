class Confetti{confettiInterval=null;containerEl=null;confettiColors=["#EF2964","#00C09D","#2D87B0","#48485E","#EFFF1D"];confettiAnimations=["slow","medium","fast"];timeRun=0;constructor(t){t&&(this.container=t,this.setupElement(),this.render())}setupElement=()=>{if(!this.container)return;const t=document.createElement("div"),e=this.container.style.position;"relative"===e&&"absolute"===e||(this.container.style.position="relative"),t&&t.classList.add("confetti-container"),this.container.appendChild(t),this.containerEl=t};stopConfetti=()=>{clearInterval(this.confettiInterval),setTimeout((()=>this.containerEl.remove()),1500)};render=()=>{this.confettiInterval=setInterval((()=>{this.timeRun+=1,this.timeRun>=160&&this.stopConfetti();const t=document.createElement("div"),e=Math.floor(3*Math.random())+7+"px",s=this.confettiColors[Math.floor(Math.random()*this.confettiColors.length)],i=Math.floor(Math.random()*this.container.offsetWidth)+"px",o=this.confettiAnimations[Math.floor(Math.random()*this.confettiAnimations.length)];t.classList.add("confetti","confetti--animation-"+o),t.style.left=i,t.style.width=e,t.style.height=e,t.style.backgroundColor=s,t.removeTimeout=setTimeout((function(){t.parentNode.removeChild(t)}),3e3),this.containerEl.appendChild(t)}),20)}}customElements.define("foxkit-cart-goal",class extends HTMLElement{constructor(){super(),this.selectors={cartContainer:".scd__content, cart-items",cartFooter:"#main-cart-footer, .cart-footer, .cart__footer, .sf-cart__summary",cartSubtotal:"[data-cart-subtotal], .cart__footer .totals, #main-cart-footer .totals",shippingNote:"[data-shipping-note], .tax-note",title:".foxkit-cartgoal__title",progressBar:"[data-progress]",goalLeft:"[data-goal-left]",icon:".foxkit-cartgoal__icon"},this.classes={hidden:"!foxkit-hidden",hasGoal:"scd--has-cartgoal",done:"foxkit-cartgoal--done"},this.defaultIcon='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 12 12"><path fill="currentColor" d="M5.56445.761719C5.69336.503906 5.90104.375 6.1875.375s.49414.128906.62305.386719L8.20703 3.59766l3.13677.47265c.2864.02865.4726.17904.5585.45117.086.27214.0287.50847-.1718.70899L9.45312 7.44336l.53711 3.13674c.04297.2721-.05013.487-.27929.6445-.22917.1719-.4655.1934-.70899.0645L6.1875 9.82812 3.37305 11.2891c-.24349.1432-.47982.1289-.70899-.043-.22916-.1719-.32226-.3939-.27929-.666l.53711-3.13674L.644531 5.23047C.44401 5.02995.386719 4.79362.472656 4.52148c.085938-.27213.272136-.42252.558594-.45117l3.13672-.47265L5.56445.761719z"/></svg>',this.doneIcon='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" viewBox="0 0 12 12"><path fill="currentColor" d="M5.56445.761719C5.69336.503906 5.90104.375 6.1875.375s.49414.128906.62305.386719L8.20703 3.59766l3.13677.47265c.2864.02865.4726.17904.5585.45117.086.27214.0287.50847-.1718.70899L9.45312 7.44336l.53711 3.13674c.04297.2721-.05013.487-.27929.6445-.22917.1719-.4655.1934-.70899.0645L6.1875 9.82812 3.37305 11.2891c-.24349.1432-.47982.1289-.70899-.043-.22916-.1719-.32226-.3939-.27929-.666l.53711-3.13674L.644531 5.23047C.44401 5.02995.386719 4.79362.472656 4.52148c.085938-.27213.272136-.42252.558594-.45117l3.13672-.47265L5.56445.761719z"/></svg>',this.progress=0,this.goalDone=!1,this.enabled=!0,this.settings=window.FoxKitPlugins.CartGoal,this.goal=Number(this.settings.goal_amount)*Number(window.Shopify.currency.rate||1)||0,this.reached_message=window.__i18n.transPlugin({configs:this.settings,key:"message_reached"}),this.message=window.__i18n.transPlugin({configs:this.settings,key:"message"}),this.cartPriceKey="SUBTOTAL"===this.settings.based_price?"original_total_price":"total_price"}connectedCallback(){if(!window.FoxKitThemeHelperEnabled)return;this.dataset.plugin="CartGoal",this.classList.add("foxkit-cartgoal","!foxkit-hidden"),this.domNodes=window.FoxKitV2.Utils.queryDomNodes(this.selectors,this);const t=this.closest(this.selectors.cartContainer),e=document.querySelector(this.selectors.cartFooter);t&&t.classList.add(this.classes.hasGoal),e&&(this.shippingNote=e.querySelector(this.selectors.shippingNote),this.cartSubtotal=e.querySelector(this.selectors.cartSubtotal)),this.confettiShow=this.goalDone,this.cacheShowKey="_foxKit_reachedGoal",this.triggerEvent=!1,this.renderShippingBadge(),this.updateProgress(),window.FoxkitEvents.subscribe("ON_FOXKIT_CART_UPDATE",(t=>this.handleChange(t))),this.querySelector(this.selectors.progressBar)||this.renderTemplate()}disconnectedCallback(){window.FoxkitEvents.unSubscribe("ON_FOXKIT_CART_UPDATE",(t=>this.handleChange(t)))}renderTemplate(){this.innerHTML=`<h4 class='foxkit-cartgoal__title'>${this.message.replace("{{variable}}",`<strong>${this.settings?.goal_amount||0}</strong>`)}</h4>\n        <div class='foxkit-cartgoal__inner'>\n          <div class='foxkit-cartgoal__bar'>\n            <span data-progress="0"></span>\n          </div>\n          <span class='foxkit-cartgoal__icon'>${this.defaultIcon}</span>\n        </div>`}async updateProgress(t){t||(t=await window.FoxKitV2.getCart()),this.enabled=t.requires_shipping;const e=t._foxCartPrices?t._foxCartPrices[this.cartPriceKey]:t[this.cartPriceKey];this.goalLeft=100*this.goal-e,this.progress=this.goalLeft>0?e/this.goal:100,this.goalDone=this.goalLeft<=0,this.goalTitle=this.goalDone?this.reached_message:this.message,this.domNodes.icon&&(this.domNodes.icon.innerHTML=this.goalDone?this.doneIcon:this.defaultIcon),this.style.setProperty("--progress",this.progress+"%"),this.goalTitle=this.goalTitle.replace("{{variable}}",`<strong>${FoxKitV2.Utils.formatMoney(this.goalLeft,FoxKitSettings.moneyFormat)}</strong>`),setTimeout((()=>{const t=this.goalDone?"add":"remove";this.querySelector(this.selectors.title).innerHTML=this.goalTitle,this.classList[t](this.classes.done)}),500),this.setDone(),this.enabled?(this.classList.remove(this.classes.hidden),this.removeAttribute("hidden")):(this.setAttribute("hidden",""),this.classList.add(this.classes.hidden),this.freeBadge&&this.freeBadge.remove())}handleChange(t){this.domNodes=FoxKitV2.Utils.queryDomNodes(this.selectors),this.updateProgress(t);const e=this.goalDone?"add":"remove";this.classList[e]("shakeY"),this.goalLeft<=0?(this.triggerEvent||(publishWebPixelsEvent({plugin:"CartGoal",pluginId:this.settings._id},WEB_PIXELS_EVENT.REACHED_GOAL),this.triggerEvent=!0),this.showConfetti()):(this.triggerEvent=!1,this.confettiShow=!1,window.FoxKitV2.Utils.setSessionStorage(this.cacheShowKey,!1))}setDone(){this.freeBadge&&this.freeBadge.remove(),this.shippingNote&&this.shippingNote.classList.remove(this.classes.hidden),this.goalDone&&this.enabled?(window.FoxKitV2.freeShip=!0,this.addShippingNote()):window.FoxKitV2.freeShip=!1}showConfetti(){const t=window.FoxKitV2.Utils.getSessionStorage(this.cacheShowKey);!this.enabled||this.confettiShow||t||(window.FoxKitV2.Utils.setSessionStorage(this.cacheShowKey,this.settings._id),new Confetti(document.querySelector(this.selectors.cartContainer)),this.confettiShow=!0)}renderShippingBadge(){this.freeBadge=document.createElement("div"),this.freeBadge.classList.add("foxkit-cartgoal-free-shipping","flex","justify-between","items-center"),this.freeBadge.innerHTML=`<span class='shipping-label'>${window.__i18n.tr("shipping_label")}</span> <span class='free-label'>${window.__i18n.tr("free")}</span>`}addShippingNote=()=>{this.cartSubtotal&&this.domNodes.cartSubtotal.before(this.freeBadge),this.shippingNote&&this.shippingNote.classList.add(this.classes.hidden)}});